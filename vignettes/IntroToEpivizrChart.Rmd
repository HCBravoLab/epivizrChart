---
title: "Knitting Epiviz Charts with epivizrChart"
author: "Brian Gottfried"
output:
   BiocStyle::html_document:
    includes:
      in_header: epiviz-imports.html
runtime: shiny
---

```{r setup, eval=TRUE, include=FALSE}
library(epivizrChart)
library(antiProfilesData)
```


```{r}
data(tcga_colon_blocks)
data(tcga_colon_curves)
data(apColonData)
```


Create an epiviz enivornment
```{r}
epivizEnv <- epivizEnvironment(chr="chr11")
```


Blocks Track Demo
```{r}
blocks_track <- epivizPlot(tcga_colon_blocks, datasource_name="450kMeth", epiviz_env=epivizEnv)

blocks_track
```


Means Track Demo
```{r}
means_track <- epivizPlot(tcga_colon_curves, datasource_name="450kMeth", type="bp", columns=c("cancerMean","normalMean"), epiviz_env=epivizEnv)

means_track
```

Scatter Plot Demo
```{r warnings=FALSE, messages=FALSE}
keep <- pData(apColonData)$SubType!="adenoma"
apColonData <- apColonData[,keep]
status <- pData(apColonData)$Status
Indexes <- split(seq(along=status),status)

exprMat <- exprs(apColonData)
mns <- sapply(Indexes, function(ind) rowMeans(exprMat[,ind]))
mat <- cbind(colonM=mns[,"1"]-mns[,"0"], colonA=0.5*(mns[,"1"]+mns[,"0"]))

pd <- data.frame(stat=c("M","A"))
rownames(pd) <- colnames(mat)

maEset <- ExpressionSet(
  assayData=mat,
  phenoData=AnnotatedDataFrame(pd),
  featureData=featureData(apColonData),
  annotation=annotation(apColonData)
)
```

```{r include=FALSE}
eset_chart <- epivizPlot(maEset, datasource_name="MAPlot", columns=c("colonA","colonM"), epiviz_env=epivizEnv)
```

```{r eval=FALSE}
eset_chart <- epivizPlot(maEset, datasource_name="MAPlot", columns=c("colonA","colonM"), epiviz_env=epivizEnv)
```

```{r}
eset_chart
```

Show the epiviz environment
```{r}
epivizEnv
```
